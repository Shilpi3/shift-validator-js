"use strict";

var _extends = function (child, parent) {
  child.prototype = Object.create(parent.prototype, {
    constructor: {
      value: child,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  child.__proto__ = parent;
};

var keyword = require("esutils").keyword;
var isRestrictedWord = keyword.isRestrictedWord;
var isReservedWordES5 = keyword.isReservedWordES5;
var ValidationContext = (function () {
  var ValidationContext = function ValidationContext(freeBreakStatements, freeContinueStatements, usedLabelNames, freeJumpTargets, freeReturnStatements, uninitialisedDeclarators, errors, strictErrors) {
    this.freeBreakStatements = freeBreakStatements;
    this.freeContinueStatements = freeContinueStatements;
    this.usedLabelNames = usedLabelNames;
    this.freeJumpTargets = freeJumpTargets;
    this.freeReturnStatements = freeReturnStatements;
    this.uninitialisedDeclarators = uninitialisedDeclarators, this.errors = errors;
    this.strictErrors = strictErrors;
  };

  ValidationContext.empty = function () {
    return new ValidationContext([], [], [], [], [], [], [], []);
  };

  ValidationContext.prototype.addFreeBreakStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements.concat([s]), this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeBreakStatements = function () {
    return new ValidationContext([], this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeContinueStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements.concat([s]), this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeContinueStatements = function () {
    return new ValidationContext(this.freeBreakStatements, [], this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.observeIterationLabelName = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames.concat([label.name]), this.freeJumpTargets.filter(function (info) {
      return info.name !== label.name;
    }), this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.observeNonIterationLabelName = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames.concat([label.name]), this.freeJumpTargets.filter(function (info) {
      return info.name !== label.name || info.type !== "break";
    }), this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearUsedLabelNames = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, [], this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeBreakJumpTarget = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets.concat([{ name: label.name, type: "break" }]), this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeContinueJumpTarget = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets.concat([{ name: label.name, type: "continue" }]), this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeReturnStatement = function (r) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements.concat([r]), this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeReturnStatements = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, [], this.uninitialisedDeclarators, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.checkReserved = function (identifier) {
    if (isReservedWordES5(identifier.name, true)) {
      if (isReservedWordES5(identifier.name, false)) {
        return this.addError(new ValidationError(identifier, "Identifier must not be reserved word in this position"));
      }
      return this.addStrictError(new ValidationError(identifier, "Identifier must not be strict mode reserved word in this position"));
    }
    return this;
  };

  ValidationContext.prototype.checkRestricted = function (identifier) {
    var v = this.checkReserved(identifier);
    if (isRestrictedWord(identifier.name)) {
      return v.addStrictError(new ValidationError(identifier, "Identifier must not be restricted word in this position in strict mode"));
    }
    return v;
  };

  ValidationContext.prototype.addError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors.concat([e]), this.strictErrors);
  };

  ValidationContext.prototype.enforceFreeBreakAndContinueStatementErrors = function () {
    return new ValidationContext([], [], this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors.concat(this.freeBreakStatements).concat(this.freeContinueStatements), this.strictErrors);
  };

  ValidationContext.prototype.enforceFreeReturnStatementErrors = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, [], this.uninitialisedDeclarators, this.errors.concat(this.freeReturnStatements), this.strictErrors);
  };

  ValidationContext.prototype.addUninitialisedDeclarator = function (node) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators.concat(node), this.errors, this.strictErrors);
  };

  ValidationContext.prototype.enforceUninitialisedDeclarators = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, [], this.errors.concat(this.uninitialisedDeclarators), this.strictErrors);
  };

  ValidationContext.prototype.enforceStrictErrors = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors.concat(this.strictErrors), []);
  };

  ValidationContext.prototype.addStrictError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.uninitialisedDeclarators, this.errors, this.strictErrors.concat([e]));
  };

  ValidationContext.prototype.concat = function (v) {
    return new ValidationContext(this.freeBreakStatements.concat(v.freeBreakStatements), this.freeContinueStatements.concat(v.freeContinueStatements), this.usedLabelNames.concat(v.usedLabelNames), this.freeJumpTargets.concat(v.freeJumpTargets), this.freeReturnStatements.concat(v.freeReturnStatements), this.uninitialisedDeclarators.concat(v.uninitialisedDeclarators), this.errors.concat(v.errors), this.strictErrors.concat(v.strictErrors));
  };

  return ValidationContext;
})();

exports.ValidationContext = ValidationContext;
var ValidationError = (function (Error) {
  var ValidationError = function ValidationError(node, message) {
    this.node = node;
    this.message = message;
  };

  _extends(ValidationError, Error);

  return ValidationError;
})(Error);

exports.ValidationError = ValidationError;
//# sourceMappingURL=data:application/json;base64,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QyxNQUFNLENBQUMsRUFDNUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUN6QyxDQUFDO0dBQ0g7O1NBelJVLGlCQUFpQjs7O1FBQWpCLGlCQUFpQixHQUFqQixpQkFBaUI7SUE0UmpCLGVBQWUsY0FBUyxLQUFLO01BQTdCLGVBQWUsR0FDZixTQURBLGVBQWUsQ0FDZCxJQUFJLEVBQUUsT0FBTyxFQUFFO0FBQ3pCLFFBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ2pCLFFBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0dBQ3hCOztXQUpVLGVBQWUsRUFBUyxLQUFLOztTQUE3QixlQUFlO0dBQVMsS0FBSzs7UUFBN0IsZUFBZSxHQUFmLGVBQWUiLCJmaWxlIjoic3JjL3ZhbGlkYXRpb24tY29udGV4dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTQgU2hhcGUgU2VjdXJpdHksIEluYy5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge2tleXdvcmR9IGZyb20gXCJlc3V0aWxzXCI7XG5jb25zdCB7aXNSZXN0cmljdGVkV29yZCwgaXNSZXNlcnZlZFdvcmRFUzV9ID0ga2V5d29yZDtcblxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25Db250ZXh0IHtcblxuICBjb25zdHJ1Y3RvcihmcmVlQnJlYWtTdGF0ZW1lbnRzLCBmcmVlQ29udGludWVTdGF0ZW1lbnRzLCB1c2VkTGFiZWxOYW1lcywgZnJlZUp1bXBUYXJnZXRzLCBmcmVlUmV0dXJuU3RhdGVtZW50cywgdW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLCBlcnJvcnMsIHN0cmljdEVycm9ycykge1xuICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyA9IGZyZWVCcmVha1N0YXRlbWVudHM7XG4gICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzID0gZnJlZUNvbnRpbnVlU3RhdGVtZW50cztcbiAgICB0aGlzLnVzZWRMYWJlbE5hbWVzID0gdXNlZExhYmVsTmFtZXM7XG4gICAgdGhpcy5mcmVlSnVtcFRhcmdldHMgPSBmcmVlSnVtcFRhcmdldHM7XG4gICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyA9IGZyZWVSZXR1cm5TdGF0ZW1lbnRzO1xuICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzID0gdW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xuICAgIHRoaXMuc3RyaWN0RXJyb3JzID0gc3RyaWN0RXJyb3JzO1xuICB9XG5cbiAgc3RhdGljIGVtcHR5KCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoW10sW10sW10sW10sW10sW10sW10sW10pO1xuICB9XG5cbiAgYWRkRnJlZUJyZWFrU3RhdGVtZW50KHMpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLmNvbmNhdChbc10pLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjbGVhckZyZWVCcmVha1N0YXRlbWVudHMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIFtdLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRGcmVlQ29udGludWVTdGF0ZW1lbnQocykge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMuY29uY2F0KFtzXSksXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZUNvbnRpbnVlU3RhdGVtZW50cygpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgW10sXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIG9ic2VydmVJdGVyYXRpb25MYWJlbE5hbWUobGFiZWwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcy5jb25jYXQoW2xhYmVsLm5hbWVdKSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmZpbHRlcihpbmZvID0+IGluZm8ubmFtZSAhPT0gbGFiZWwubmFtZSksXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIG9ic2VydmVOb25JdGVyYXRpb25MYWJlbE5hbWUobGFiZWwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcy5jb25jYXQoW2xhYmVsLm5hbWVdKSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmZpbHRlcihpbmZvID0+IGluZm8ubmFtZSAhPT0gbGFiZWwubmFtZSB8fCBpbmZvLnR5cGUgIT09ICdicmVhaycpLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjbGVhclVzZWRMYWJlbE5hbWVzKCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICBbXSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRGcmVlQnJlYWtKdW1wVGFyZ2V0KGxhYmVsKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cy5jb25jYXQoW3tuYW1lOiBsYWJlbC5uYW1lLCB0eXBlOiAnYnJlYWsnfV0pLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRGcmVlQ29udGludWVKdW1wVGFyZ2V0KGxhYmVsKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cy5jb25jYXQoW3tuYW1lOiBsYWJlbC5uYW1lLCB0eXBlOiAnY29udGludWUnfV0pLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuXG4gIGFkZEZyZWVSZXR1cm5TdGF0ZW1lbnQocikge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLmNvbmNhdChbcl0pLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZVJldHVyblN0YXRlbWVudHMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIFtdLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNoZWNrUmVzZXJ2ZWQoaWRlbnRpZmllcikge1xuICAgIGlmIChpc1Jlc2VydmVkV29yZEVTNShpZGVudGlmaWVyLm5hbWUsIHRydWUpKSB7XG4gICAgICBpZiAoaXNSZXNlcnZlZFdvcmRFUzUoaWRlbnRpZmllci5uYW1lLCBmYWxzZSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkRXJyb3IobmV3IFZhbGlkYXRpb25FcnJvcihpZGVudGlmaWVyLCBcIklkZW50aWZpZXIgbXVzdCBub3QgYmUgcmVzZXJ2ZWQgd29yZCBpbiB0aGlzIHBvc2l0aW9uXCIpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmFkZFN0cmljdEVycm9yKG5ldyBWYWxpZGF0aW9uRXJyb3IoaWRlbnRpZmllciwgXCJJZGVudGlmaWVyIG11c3Qgbm90IGJlIHN0cmljdCBtb2RlIHJlc2VydmVkIHdvcmQgaW4gdGhpcyBwb3NpdGlvblwiKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2hlY2tSZXN0cmljdGVkKGlkZW50aWZpZXIpIHtcbiAgICBsZXQgdiA9IHRoaXMuY2hlY2tSZXNlcnZlZChpZGVudGlmaWVyKTtcbiAgICBpZiAoaXNSZXN0cmljdGVkV29yZChpZGVudGlmaWVyLm5hbWUpKSB7XG4gICAgICByZXR1cm4gdi5hZGRTdHJpY3RFcnJvcihuZXcgVmFsaWRhdGlvbkVycm9yKGlkZW50aWZpZXIsIFwiSWRlbnRpZmllciBtdXN0IG5vdCBiZSByZXN0cmljdGVkIHdvcmQgaW4gdGhpcyBwb3NpdGlvbiBpbiBzdHJpY3QgbW9kZVwiKSk7XG4gICAgfVxuICAgIHJldHVybiB2O1xuICB9XG5cbiAgYWRkRXJyb3IoZSkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycy5jb25jYXQoW2VdKSxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGVuZm9yY2VGcmVlQnJlYWtBbmRDb250aW51ZVN0YXRlbWVudEVycm9ycygpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgW10sXG4gICAgICBbXSxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVuaW5pdGlhbGlzZWREZWNsYXJhdG9ycyxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdCh0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMpLmNvbmNhdCh0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMpLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgZW5mb3JjZUZyZWVSZXR1cm5TdGF0ZW1lbnRFcnJvcnMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIFtdLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycy5jb25jYXQodGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyksXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRVbmluaXRpYWxpc2VkRGVjbGFyYXRvcihub2RlKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVuaW5pdGlhbGlzZWREZWNsYXJhdG9ycy5jb25jYXQobm9kZSksXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGVuZm9yY2VVbmluaXRpYWxpc2VkRGVjbGFyYXRvcnMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICBbXSxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdCh0aGlzLnVuaW5pdGlhbGlzZWREZWNsYXJhdG9ycyksXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBlbmZvcmNlU3RyaWN0RXJyb3JzKCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycy5jb25jYXQodGhpcy5zdHJpY3RFcnJvcnMpLFxuICAgICAgW11cbiAgICApO1xuICB9XG5cbiAgYWRkU3RyaWN0RXJyb3IoZSkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51bmluaXRpYWxpc2VkRGVjbGFyYXRvcnMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzLmNvbmNhdChbZV0pXG4gICAgKTtcbiAgfVxuXG4gIGNvbmNhdCh2KSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dCAoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMuY29uY2F0KHYuZnJlZUJyZWFrU3RhdGVtZW50cyksXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMuY29uY2F0KHYuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyksXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLmNvbmNhdCh2LnVzZWRMYWJlbE5hbWVzKSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmNvbmNhdCh2LmZyZWVKdW1wVGFyZ2V0cyksXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLmNvbmNhdCh2LmZyZWVSZXR1cm5TdGF0ZW1lbnRzKSxcbiAgICAgIHRoaXMudW5pbml0aWFsaXNlZERlY2xhcmF0b3JzLmNvbmNhdCh2LnVuaW5pdGlhbGlzZWREZWNsYXJhdG9ycyksXG4gICAgICB0aGlzLmVycm9ycy5jb25jYXQodi5lcnJvcnMpLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnMuY29uY2F0KHYuc3RyaWN0RXJyb3JzKVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3Iobm9kZSwgbWVzc2FnZSkge1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgfVxufVxuIl19